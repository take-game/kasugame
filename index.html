
<script src="processing.js"></script>
<script type="text/processing" data-processing-target="processing-canvas">

int gseq;
int mcnt;
int hp;
float e_speed = 4.5;
int e_diameter = 20;
float[]e_x = new float[10];
float[]e_y = new float[10];
int px =200;
int py =350;
int pw =20;
int ph =20; 
int currentTime;
int time1;
int time2;
float i_speed = 5.5;
int i_diameter = 10;
float i_x;
float i_y;

void setup(){
  size(400,400);
  noStroke();
  gameInit();
}
void draw(){
  background(0);
  if( gseq == 0){
    gameTitle();
  }else if( gseq == 1){
    gamePlay();
  }else if ( gseq == 2){
    gameOver();
  }else if ( gseq == 3){
    estop();
  }else if( gseq == 4){
    gameClear();
  }
}
void gameInit(){
  gseq= 0;
  mcnt = 0;
  hp = 3;
  px =200;
  py =350;
  for(int i=0;i<10;i++){
    e_x[i] = (width-500+100*i)/2;
    e_y[i] = height/2;
  }
  i_x = width/2;
  i_y = (height-100)/2;
}
void gamePlay(){
  pDisp();
  pMove();
  eDisp();
  eMove();
  iDisp();
  iMove();
  hitCheck();
  scoreDisp();
  if(hp<1){
    gseq=2;
  }
}
void gameOver(){
  textSize(50);
  fill(255,255,0);
  text("GAME OVER",60,200);
  mcnt++;
  if((mcnt%60) <40){
    textSize(20);
    fill(255);
    text("Click to retry!",140,260);
  }
}
void gameTitle(){
  eDisp();
  pDisp();
  iDisp();
  scoreDisp();
  mcnt++;
  if((mcnt%60) < 40){
    textSize(20);
    fill(20,100,100);
    text("Click to start",140,360);
  }
}
void eDisp(){
    for(int i=0;i<10;i++){
      fill(255);
      ellipse(e_x[i], e_y[i], e_diameter, e_diameter);
  }
}
void eMove(){
  for(int i=0;i<10;i++){
    e_x[i] += random(-e_speed, e_speed);
    e_y[i] += random(-e_speed, e_speed);
    e_x[i] = constrain(e_x[i], 0, width);
    e_y[i] = constrain(e_y[i], 0, height);
    ellipse(e_x[i], e_y[i], e_diameter, e_diameter);
  }
}
void mousePressed(){
  if( gseq == 0 ){
    gseq = 1;
  }
  if( gseq ==1 && keyPressed ){
    hp--;
    gseq = 3;
    currentTime = millis();
    time1 = 5000 + currentTime;
  }
  if( gseq == 2){
    gameInit();
  }
  if( gseq == 4 ){
    gameInit();
  }
}
void pDisp(){
  fill(255);
  rect(px,py,pw,ph,5);
}
void pMove(){
  if(keyPressed && (key == CODED)) {
      if(keyCode == LEFT) {
        px=px-3;
      }
      else if(keyCode == RIGHT) {
        px=px+3;
      }
      else if(keyCode == UP) {
        py=py-3;
      }
      else if(keyCode == DOWN) {
        py=py+3;
      }
    }
  rect(px,py,pw,ph,5);
}
void hitCheck(){
  for(int i=0;i<10;i++){
    if((px< (e_x[i]+e_diameter)) &&((px+pw) >e_x[i])
    &&(py <(e_y[i]+e_diameter)) && ((py+ph) > e_y[i])){
      hp--;
      eHitInit(i);
    }
  }
  if((px< (i_x+i_diameter)) &&((px+pw) >i_x)
    &&(py <(i_y+i_diameter)) && ((py+ph) > i_y)){
      gseq = 4;
    }
}
void eHitInit(int no){
  e_x[no] = (width-500+1000*random(-1,1))/2;
  e_y[no] = (height+1000*random(-1,1))/2;
  fill(255);
  ellipse(e_x[no], e_y[no], e_diameter, e_diameter);
}
void scoreDisp(){
  textSize(24);
  fill(255);
  text("HP:"+hp,300,25);
}
void estop(){
  int time2 = millis();
    eDisp();
    pDisp();
    iDisp();
    pMove();
    hitCheck();
    scoreDisp();
    if(hp<1){
      gseq= 2;
    } 
    if(time2 > time1){
      gseq = 1;
    }
}
void iDisp(){
        fill(0,255,0);
        ellipse(i_x, i_y, i_diameter, i_diameter);
}
void iMove(){
    i_x += random(-i_speed, i_speed);
    i_y += random(-i_speed, i_speed);
    i_x = constrain(i_x, 0, width);
    i_y = constrain(i_y, 0, height);
    ellipse(i_x, i_y, i_diameter, i_diameter);
}
void gameClear(){
  scoreDisp();
  mcnt++;
  if((mcnt%60) < 40){
    textSize(50);
    fill(255,255,0);
    text("Game Clear!!",58,200);
  }
}

</script>
<canvas id="processing-canvas"></canvas>
